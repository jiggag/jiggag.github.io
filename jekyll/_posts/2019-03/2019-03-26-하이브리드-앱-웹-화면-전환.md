---
layout: post
published: true
title : 웹에서 앱 기능 호출 시 한번만 화면 전환하도록
subtitle : 하이브리드 앱에서 코르도바 사용했을때
tags: [android,cordova,hybrid,plugin]
---
## 웹에서 앱 기능 호출 시
하이브리드 앱으로 웹에서 앱 기능 호출 시 코르도바를 사용하였다.  
아래는 사용자가 다음 단계로 넘어가기 위해 동영상 광고를 시청해야하고 앱에 구현되어 있는 광고 플러그인을 호출하는 코드이다.  
```
window.cordova.exec(function(result){
	if(result === 1 || result === 2) {
    /*
      첫번째 광고를 정상적으로 보거나 스킵한 경우
      >>> 정상 진행
    */
	} else if(result === 3) {
		/*
      첫번째 광고가 없거나 오류난 경우
      >>> 두번째 광고 호출
    */
		window.cordova.exec(function(result){
			if(result === 1 || result === 2){
				/*
          두번째 광고를 정상적으로 보거나 스킵한 경우
          >>> 정상 진행
        */
			}else if(result === 3){
        /*
          두번째 광고도 없거나 오류난 경우
          >>> 광고 없음 알림창 표시 후 진행
        */
			};
		}, function(error){}, "AdPlugin", "Second", []);
		
	};
}, function(error){}, "AdPlugin", "First", []);
```
동영상 광고 플러그인은 제공받은 것을 사용하였고 각각 호출하여 리턴값에 따라 사용자가 광고를 봤는지 스킵했는지 비정상 종료를 하였는지를 판단하였다.  
이에 첫번째 광고를 호출하였는데 제공되는 광고를 모두 소진하였거나 오류가 발생한 경우 두번째 광고를 호출하여 사용자가 광고를 볼 수 있도록 하였고 두번째 광고마저도 소진되었거나 오류가 발생한 경우에만 다음 단계로 진행될 수 있도록 하였다.  
근데 여기서 문제점은 웹에서 앱 기능을 호출하기 위해 코르도바 플러그인을 사용했는데 이 플러그인을 호출하는 과정에서 사용자가 보고 있는 화면이 웹에서 검은 화면, 다시 웹으로, 다시 검은 화면, 다시 웹이 보여지게 되어 마치 이거 고장난거 아닌가 하는 생각이 들게 하였다.  
처음에는 핸드폰이 너무 느려서일까 생각해봤는데 웹에서 앱을 호출해야하며 다시 앱에서 웹을 호출하고 다시 웹에서 앱을 호출했다가 다시 앱에서 웹을 호출하여 돌아오는 이 긴 여정의 결과였다.  

## 한번만 갔다오면
결국 하이브리드 앱은 웹에서 구현되어야 하기 때문에 앱 기능을 사용할 때 한번만 웹에서 앱을 호출하면 저런 검은 화면은 보지 않아도 될 것이다.
위의 동영상 광고 호출도 웹에서 통합된 광고 플러그인을 한번만 호출하고 앱 내에서 리턴값을 판단하여 다음 광고 호출 여부를 확인했으면 되는 것이다.  
코드를 다시 수정해보면 이렇다.
```
window.cordova.exec(function(result){
	if(result === 1 || result === 2) {
    /*
      광고를 정상적으로 보거나 스킵한 경우
      >>> 정상 진행
    */
	} else if(result === 3) {
    /*
      광고가 없거나 오류난 경우
      >>> 광고 없음 알림창 표시 후 진행
    */
	};
}, function(error){}, "AdPlugin", "Ads", []);
```
첫번째 광고 플러그인에 앱에서 웹으로 리턴해주는 부분의 코드를 값에 따라 두번째 광고 플러그인을 호출 할 지 웹으로 돌려보낼지를 확인해주면 될 것이다.  
그럼 사용자는 검은 화면이 왔다갔다 하는 장면을 보지 않아도 되겠지!??  
